<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Library System Marking Helper</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 20px; }
    ul { list-style: none; padding-left: 0; }
    li { margin: 5px 0; }
    input[type="checkbox"] { margin-right: 8px; }
    #overallComment {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
      min-height: 50px;
      white-space: pre-wrap;
    }
    .buttons { margin-top: 10px; }
    button {
      padding: 6px 12px;
      margin-right: 8px;
      border: none;
      border-radius: 6px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover { background-color: #0056b3; }
    #scoreBox { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Library System Marking Script</h1>

  <div id="tasks">

    <h2>Task 1: Get All Authors</h2>
    <ul>
      <li><label><input type="checkbox" value="-0.25 Response not JSON or wrong Content-Type"> -0.25 Response not JSON or wrong Content-Type</label></li>
      <li><label><input type="checkbox" value="-0.25 Count missing or wrong shape ({authors:[...], count:N})"> -0.25 Count missing or wrong shape ({authors:[...], count:N})</label></li>
      <li><label><input type="checkbox" value="-0.25 Not querying MongoDB with Author model / returns hardcoded data"> -0.25 Not querying MongoDB with Author model / returns hardcoded data</label></li>
      <li><label><input type="checkbox" value="-0.25 Wrong status code (should be 200) or malformed array/shape"> -0.25 Wrong status code (should be 200) or malformed array/shape</label></li>
      <li><label><input type="checkbox" value="0 Endpoint not implemented"> 0 Endpoint not implemented</label></li>
    </ul>

    <h2>Task 2: Create Author</h2>
    <ul>
      <li><label><input type="checkbox" value="-0.5 Author not created/saved with Mongoose"> -0.5 Author not created/saved with Mongoose</label></li>
      <li><label><input type="checkbox" value="-0.25 Required fields missing/ignored or body keys mismatch (authorName, authorCountry, yearBorn)"> -0.25 Required fields missing/ignored or body keys mismatch (authorName, authorCountry, yearBorn)</label></li>
      <li><label><input type="checkbox" value="-0.25 Invalid type allowed (non-number for yearBorn)"> -0.25 Invalid type allowed (non-number for yearBorn)</label></li>
      <li><label><input type="checkbox" value="-0.25 Wrong status code or response shape (should be 200/201 and include {message, author})"> -0.25 Wrong status code or response shape (should be 200/201 and include {message, author})</label></li>
      <li><label><input type="checkbox" value="-0.25 Unhandled errors (no try/catch)"> -0.25 Unhandled errors (no try/catch)</label></li>
      <li><label><input type="checkbox" value="0 Endpoint not implemented"> 0 Endpoint not implemented</label></li>
    </ul>

    <h2>Task 3: Update Author</h2>
    <ul>
      <li><label><input type="checkbox" value="-0.25 Does not update author by :id"> -0.25 Does not update author by :id</label></li>
      <li><label><input type="checkbox" value="-0.25 Fails to keep _id immutable or doesn’t restrict updates"> -0.25 Fails to keep _id immutable or doesn’t restrict updates</label></li>
      <li><label><input type="checkbox" value="-0.25 Missing {new:true, runValidators:true}"> -0.25 Missing {new:true, runValidators:true}</label></li>
      <li><label><input type="checkbox" value="-0.25 Not-found not handled (should return 404 {error:'Author not found'})"> -0.25 Not-found not handled (should return 404 {error:'Author not found'})</label></li>
      <li><label><input type="checkbox" value="-0.25 Wrong status code (should be 200) or not returning updated author"> -0.25 Wrong status code (should be 200) or not returning updated author</label></li>
      <li><label><input type="checkbox" value="0 Endpoint not implemented"> 0 Endpoint not implemented</label></li>
    </ul>

    <h2>Task 4: Delete Author</h2>
    <ul>
      <li><label><input type="checkbox" value="-0.25 Does not delete by :id with Mongoose"> -0.25 Does not delete by :id with Mongoose</label></li>
      <li><label><input type="checkbox" value="-0.25 Not-found not handled (should return 404 {error:'Author not found'})"> -0.25 Not-found not handled (should return 404 {error:'Author not found'})</label></li>
      <li><label><input type="checkbox" value="-0.25 Wrong status code on success (should be 200) or missing JSON success message"> -0.25 Wrong status code on success (should be 200) or missing JSON success message</label></li>
      <li><label><input type="checkbox" value="-0.25 Fails to validate/catch invalid ObjectId"> -0.25 Fails to validate/catch invalid ObjectId</label></li>
      <li><label><input type="checkbox" value="0 Endpoint not implemented"> 0 Endpoint not implemented</label></li>
    </ul>

    <h2>Task 5: Get All Books</h2>
    <ul>
      <li><label><input type="checkbox" value="-0.25 Response not JSON or wrong Content-Type"> -0.25 Response not JSON or wrong Content-Type</label></li>
      <li><label><input type="checkbox" value="-0.25 Does not use .populate('authorId','authorName')"> -0.25 Does not use .populate('authorId','authorName')</label></li>
      <li><label><input type="checkbox" value="-0.25 Not querying MongoDB with Book model / returns hardcoded data"> -0.25 Not querying MongoDB with Book model / returns hardcoded data</label></li>
      <li><label><input type="checkbox" value="-0.25 Wrong status code (should be 200) or malformed array/shape"> -0.25 Wrong status code (should be 200) or malformed array/shape</label></li>
      <li><label><input type="checkbox" value="0 Endpoint not implemented"> 0 Endpoint not implemented</label></li>
    </ul>

    <h2>Task 6: Create Book</h2>
    <ul>
      <li><label><input type="checkbox" value="-0.5 Book not created/saved with valid authorId reference"> -0.5 Book not created/saved with valid authorId reference</label></li>
      <li><label><input type="checkbox" value="-0.25 Fails to verify authorId exists (creates book with non-existent author)"> -0.25 Fails to verify authorId exists (creates book with non-existent author)</label></li>
      <li><label><input type="checkbox" value="-0.25 Missing/invalid body parsing or schema key mismatch (bookTitle, isbn, publishedYear, authorId)"> -0.25 Missing/invalid body parsing or schema key mismatch (bookTitle, isbn, publishedYear, authorId)</label></li>
      <li><label><input type="checkbox" value="-0.25 Wrong status code or response shape (should be 200/201 and include {message, book})"> -0.25 Wrong status code or response shape (should be 200/201 and include {message, book})</label></li>
      <li><label><input type="checkbox" value="-0.25 Errors not handled properly as JSON"> -0.25 Errors not handled properly as JSON</label></li>
      <li><label><input type="checkbox" value="0 Endpoint not implemented"> 0 Endpoint not implemented</label></li>
    </ul>

    <h2>General Deduction</h2>
    <ul>
      <li><label><input type="checkbox" value="-2 Very bad appearance (no CSS, broken layout)"> -2 Very bad appearance (no CSS, broken layout)</label></li>
      <li><label><input type="checkbox" value="-3 Using CDN instead of local static assets"> -3 Using CDN instead of local static assets</label></li>
      <li><label><input type="checkbox" value="-3 node_modules not removed"> -3 node_modules not removed</label></li>
      <li><label><input type="checkbox" value="-3 Unauthorized third-party library (except allowed ones)"> -3 Unauthorized third-party library (except allowed ones)</label></li>
      <li><label><input type="checkbox" value="-3 package.json missing"> -3 package.json missing</label></li>
    </ul>

  </div>

  <h2>Overall Comment</h2>
  <div id="overallComment"></div>
  <div class="buttons">
    <button id="copyBtn">Copy Comment</button>
    <button id="clearBtn">Clear Selection</button>
  </div>

  <div id="scoreBox">
    <p>Computed Deductions: <span id="computed">0</span></p>
    <p>Final Score (out of 100): <span id="score">100</span></p>
  </div>

  <script>
    function update() {
      const commentBox = document.getElementById("overallComment");
      commentBox.innerHTML = "";

      let sum = 0;
      document.querySelectorAll("h2").forEach((h2) => {
        const nextUl = h2.nextElementSibling;
        if (nextUl && nextUl.tagName === "UL") {
          const checked = Array.from(nextUl.querySelectorAll("input[type=checkbox]:checked"));
          if (checked.length > 0) {
            commentBox.innerHTML += "<b>" + h2.textContent + "</b><br>";
            checked.forEach(cb => {
              commentBox.innerHTML += cb.value + "<br>";
              const num = parseFloat(cb.value);
              if (!isNaN(num)) sum += num;
            });
            commentBox.innerHTML += "<br>";
          }
        }
      });

      document.getElementById("computed").textContent = sum.toFixed(2);
      document.getElementById("score").textContent = (100 + sum).toFixed(2);
    }

    document.querySelectorAll('#tasks input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', update);
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      const text = document.getElementById('overallComment').innerText;
      navigator.clipboard.writeText(text).then(() => alert('Comment copied!'));
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      document.querySelectorAll('#tasks input[type="checkbox"]').forEach(cb => cb.checked = false);
      update();
    });

    update();
  </script>
</body>
</html>
