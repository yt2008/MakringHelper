<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lab Marking Script — Movie Theater System</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--muted:#555;--accent:#0b61d6}
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 18px; background:#f6f8fa; color:#111; }
    .card { background:#fff; border-radius:10px; padding:18px; box-shadow:0 8px 30px rgba(15,30,50,0.06); max-width:1100px; margin:0 auto; }
    h1 { margin:0 0 12px 0; font-size:20px; }
    h2 { margin:18px 0 8px 0; font-size:16px; color:var(--accent); }
    ul { list-style:none; padding-left:0; margin:0; }
    li { margin:6px 0; }
    label { cursor:pointer; display:inline-flex; align-items:center; gap:8px; user-select:none; }
    input[type="checkbox"] { width:18px; height:18px; margin:0; }
    #overallComment { border:1px solid #e6eef8; background:#fbfdff; padding:12px; min-height:120px; white-space:pre-wrap; border-radius:6px; margin-top:8px; }
    .controls { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    button { background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
    button.ghost { background:#e6eef8; color:var(--accent); border:1px solid #cfe0fb; }
    .stats { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
    .stat { background:#fff; border:1px solid #eef3fb; padding:8px 10px; border-radius:8px; min-width:160px; }
    .muted { color:var(--muted); font-size:13px; }
    .score { font-weight:700; font-size:18px; color:#0a7a0a; }
    footer { margin-top:18px; font-size:13px; color:var(--muted); }
    .note { font-size:13px; color:var(--muted); margin-top:6px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Lab Marking Script — Movie Theater System (Tasks 1–8)</h1>
    <div class="note">Click the text to toggle a checkbox. Checked items are appended to the Overall Comment (grouped under their Task heading). Computed deduction and resulting score are shown below.</div>

    <!-- TASKS -->
    <section id="tasks">

      <h2>Task 1: Homepage</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Missing required info in rendered template (system name, student name, student ID)"> -0.25: Missing required info in rendered template (system name, student name, student ID)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Template not rendered with res.render or route not responding with HTML."> -0.25: Template not rendered with res.render or route not responding with HTML.</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Hyperlinks to Movies List, Add Movie Form, Bookings List, and Add Booking Form are missing or broken."> -0.25: Hyperlinks to Movies List, Add Movie Form, Bookings List, and Add Booking Form are missing or broken.</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented."> 0: Endpoint not implemented.</label></li>
      </ul>

      <h2>Task 2: Show Table 1 (Movies list)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Movie list view not rendered with EJS directives to loop and display all movies from MongoDB using the Movie model"> -0.25: Movie list view not rendered with EJS directives to loop and display all movies from MongoDB using the Movie model</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: HTML table missing or does not include required attributes per schema (movieTitle, movieDirector, ticketPrice)"> -0.25: HTML table missing or does not include required attributes per schema (movieTitle, movieDirector, ticketPrice)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Does not show movie count in the page as specified in scenario notes"> -0.25: Does not show movie count in the page as specified in scenario notes</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented."> 0: Endpoint not implemented.</label></li>
      </ul>

      <h2>Task 3: Add Table 1 (GET)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Form missing any required field input: movieTitle, movieDirector, ticketPrice, with proper types (text, text, number) and submit button"> -0.25: Form missing any required field input: movieTitle, movieDirector, ticketPrice, with proper types (text, text, number) and submit button</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Form action not pointing to POST /studentFirstName/movies/add or uses the wrong HTTP method"> -0.25: Form action not pointing to POST /studentFirstName/movies/add or uses the wrong HTTP method</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: View not rendered as HTML via res.render, or malformed/invalid inputs allowed for numeric field"> -0.25: View not rendered as HTML via res.render, or malformed/invalid inputs allowed for numeric field</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented"> 0: Endpoint not implemented</label></li>
      </ul>

      <h2>Task 4: Add Table 1 (POST)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.5" data-text="-0.5: New Movie document is not created with Mongoose and saved to MongoDB"> -0.5: New Movie document is not created with Mongoose and saved to MongoDB</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Form data not correctly extracted from req.body or field names mismatch schema keys (movieTitle, movieDirector, ticketPrice)"> -0.25: Form data not correctly extracted from req.body or field names mismatch schema keys (movieTitle, movieDirector, ticketPrice)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Missing middleware to parse body, resulting in failed processing (only penalise here once)"> -0.25: Missing middleware to parse body, resulting in failed processing (only penalise here once)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Validation/type issues not handled (non-number for ticketPrice accepted or save attempted without required fields)"> -0.25: Validation/type issues not handled (non-number for ticketPrice accepted or save attempted without required fields)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Does not redirect to /studentFirstName/movies after successful add"> -0.25: Does not redirect to /studentFirstName/movies after successful add</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented"> 0: Endpoint not implemented</label></li>
      </ul>

      <h2>Task 5: Show Table 2 (Bookings list)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Bookings list view not rendered with EJS and does not use populate to show the related Movie title for each booking"> -0.25: Bookings list view not rendered with EJS and does not use populate to show the related Movie title for each booking</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: HTML table missing or does not include required attributes (customerName, numberOfSeats, totalAmount, and populated movie title)"> -0.25: HTML table missing or does not include required attributes (customerName, numberOfSeats, totalAmount, and populated movie title)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Fails to query bookings from MongoDB or returns a non-HTML response"> -0.25: Fails to query bookings from MongoDB or returns a non-HTML response</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented"> 0: Endpoint not implemented</label></li>
      </ul>

      <h2>Task 6: Add Table 2 (GET)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Form missing required inputs for customerName and numberOfSeats and a select/dropdown of available Movies sourced from DB (movieId)"> -0.25: Form missing required inputs for customerName and numberOfSeats and a select/dropdown of available Movies sourced from DB (movieId)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Form action not pointing to POST /studentFirstName/bookings/add or wrong HTTP method"> -0.25: Form action not pointing to POST /studentFirstName/bookings/add or wrong HTTP method</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Dropdown not populated from live Movie collection or value does not submit a valid ObjectId"> -0.25: Dropdown not populated from live Movie collection or value does not submit a valid ObjectId</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented"> 0: Endpoint not implemented</label></li>
      </ul>

      <h2>Task 7: Add Table 2 (POST)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.5" data-text="-0.5: Booking document not created and saved to MongoDB with a valid movieId reference"> -0.5: Booking document not created and saved to MongoDB with a valid movieId reference</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Form data not correctly extracted from req.body or field names mismatch schema keys (customerName, numberOfSeats)"> -0.25: Form data not correctly extracted from req.body or field names mismatch schema keys (customerName, numberOfSeats)</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Missing or incorrect use of Mongoose types (e.g., numberOfSeats not cast to Number, invalid ObjectId) or failure to validate"> -0.25: Missing or incorrect use of Mongoose types (e.g., numberOfSeats not cast to Number, invalid ObjectId) or failure to validate</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Does not redirect to /studentFirstName/bookings after adding"> -0.25: Does not redirect to /studentFirstName/bookings after adding</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented"> 0: Endpoint not implemented</label></li>
      </ul>

      <h2>Shared rule for Labs 03,04,05,09</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25 (Labs 03/04/05/09): totalAmount not calculated server-side as numberOfSeats × selected Movie.ticketPrice before save (must not come from the form)"> -0.25 (Labs 03/04/05/09): totalAmount not calculated server-side as numberOfSeats × selected Movie.ticketPrice before save (must not come from the form)</label></li>
      </ul>

      <h2>Task 8: Details (Params)</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Not using route param"> -0.25: Not using route param</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Movie not fetched by param id using Mongoose"> -0.25: Movie not fetched by param id using Mongoose</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: Does not also fetch and display all bookings for that movie (using movieId) or fails to show them in an HTML table"> -0.25: Does not also fetch and display all bookings for that movie (using movieId) or fails to show them in an HTML table</label></li>
        <li><label><input type="checkbox" data-ded="-0.25" data-text="-0.25: EJS template not rendered or missing key fields for the Movie and its Bookings; failure to use EJS directives to iterate data"> -0.25: EJS template not rendered or missing key fields for the Movie and its Bookings; failure to use EJS directives to iterate data</label></li>
        <li><label><input type="checkbox" data-ded="0" data-text="0: Endpoint not implemented"> 0: Endpoint not implemented</label></li>
      </ul>

      <h2>General Deduction</h2>
      <ul>
        <li><label><input type="checkbox" data-ded="0" data-text="General deductions (manual judgement) — use note field"> General deductions (manual judgement) — use note field</label></li>
      </ul>

    </section>

    <!-- output / controls -->
    <div class="stats">
      <div class="stat"><div class="muted">Computed deduction</div><div id="computedDed">0.00</div></div>
      <div class="stat"><div class="muted">Score (out of 100)</div><div id="score" class="score">100.00</div></div>
    </div>

    <h2 style="margin-top:14px">Overall Comment</h2>
    <div id="overallComment" aria-live="polite"></div>

    <div class="controls">
      <button id="copyBtn">Copy Comment</button>
      <button id="clearBtn" class="ghost">Clear Selection</button>
    </div>

    <footer>
      Tip: click any line's text to toggle the checkbox. Decimal deductions are summed; zero-value items are shown in comments but do not affect the score.
    </footer>
  </div>

  <script>
    function parseDed(v) {
      const n = parseFloat(v);
      return isNaN(n) ? 0 : n;
    }

    function update() {
      const computedEl = document.getElementById('computedDed');
      const scoreEl = document.getElementById('score');
      const commentEl = document.getElementById('overallComment');
      commentEl.innerHTML = '';

      let sum = 0;
      const headings = Array.from(document.querySelectorAll('#tasks h2'));
      headings.forEach(h2 => {
        const next = h2.nextElementSibling;
        if (!next || next.tagName !== 'UL') return;
        const checked = Array.from(next.querySelectorAll('input[type="checkbox"]:checked'));
        if (checked.length === 0) return;

        const titleNode = document.createElement('div');
        titleNode.innerHTML = '<strong>' + h2.textContent + '</strong>';
        commentEl.appendChild(titleNode);

        checked.forEach(cb => {
          const text = cb.dataset.text || cb.parentElement.textContent.trim();
          const lineNode = document.createElement('div');
          const display = (text.trim().startsWith('-') ? text.trim() : ('- ' + text.trim()));
          lineNode.textContent = display;
          commentEl.appendChild(lineNode);
          sum += parseDed(cb.dataset.ded);
        });
        commentEl.appendChild(document.createElement('br'));
      });

      computedEl.textContent = sum.toFixed(2);
      scoreEl.textContent = (100 + sum).toFixed(2); // sum is negative or zero
    }

    document.querySelectorAll('#tasks input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', update);
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      const text = document.getElementById('overallComment').innerText;
      navigator.clipboard.writeText(text).then(() => alert('Comment copied!'));
    });
    document.getElementById('clearBtn').addEventListener('click', () => {
      document.querySelectorAll('#tasks input[type="checkbox"]').forEach(cb => cb.checked = false);
      update();
    });

    update();
  </script>
</body>
</html>
